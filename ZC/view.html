<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZC Exporter - View</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .container {
            max-width: 1100px;
            padding: 30px 20px;
            background-color: #ffffff;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
            margin-top: 20px;
        }

        /* --- Header & Logo Styling --- */
        .header-section {
            text-align: center;
            margin-bottom: 25px;
        }
        .logo-box {
            border: 2px solid #000;
            display: inline-block;
            padding: 3px 15px;
            margin-bottom: 5px;
        }
        .logo-text {
            color: #d90000;
            font-weight: bold;
            font-size: 1.4rem;
            line-height: 1;
        }
        .subtitle {
            font-size: 0.8rem;
            color: #333;
            line-height: 1;
            letter-spacing: 0.5px;
        }
        .invoice-title {
            font-size: 1.7rem;
            font-weight: 500;
            margin-top: 5px;
        }

        /* --- Table Styling --- */
        .table-box {
            border: 1px solid #000;
            padding: 15px;
            margin-bottom: 25px;
        }
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 0;
        }
        .data-table th {
            background-color: #f1f1f1;
            font-weight: 600;
            font-size: 0.9rem;
            border: 1px solid #dee2e6;
            padding: 10px;
            text-align: left;
        }
        .data-table td {
            border: 1px solid #dee2e6;
            padding: 10px;
            font-size: 0.95rem;
        }
        .data-table tbody tr:hover {
            background-color: #f9f9f9;
        }

        /* --- Action Buttons Styling --- */
        .action-buttons {
            display: flex;
            gap: 5px;
        }
        .btn-sm {
            padding: 0.3rem 0.6rem;
            font-size: 0.8rem;
        }
        .btn-edit {
            background-color: #0d6efd;
            border-color: #0d6efd;
            color: white;
        }
        .btn-edit:hover {
            background-color: #0b5ed7;
            color: white;
        }
        .btn-hide {
            background-color: #6c757d;
            border-color: #6c757d;
            color: white;
        }
        .btn-hide:hover {
            background-color: #5c636a;
            color: white;
        }
        .btn-print {
            background-color: #28a745;
            border-color: #28a745;
            color: white;
        }
        .btn-print:hover {
            background-color: #218838;
            color: white;
        }

        /* --- Top Action Bar --- */
        .action-bar {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            justify-content: space-between;
            align-items: center;
        }
        .action-bar .btn-group {
            display: flex;
            gap: 10px;
        }

        /* --- Print Styles --- */
        @media print {
            body {
                background-color: white;
            }
            .container {
                box-shadow: none;
            }
            .action-bar, .btn-print, .btn-edit, .btn-hide {
                display: none;
            }
        }
    </style>
</head>
<body>

<!-- Logo Header -->
  <div style="text-align: center; padding: 2vh 1vw; background-color: #f8f9fa; border-bottom: 3px solid #d90000;">
      <img src="/static/logo.jpg" alt="ZAKA Controls & Devices" style="height: 19vh; width: auto; max-width: 117vw; object-fit: contain;">
  </div><div class="container">
   

    <div class="action-bar">
        <div style="width: 50%; display: flex; justify-content: flex-start;">
            <a href="/" class="btn btn-secondary" style="background-color: #6c757d; border-color: #6c757d; color: white; font-weight: 500; padding: 8px 12px;">‚Üê Back</a>
        </div>
        <div style="width: 100%; display: flex; justify-content: center; align-items: center;">
            <div style="font-size: 1.7rem; font-weight: 500;">ZC</div>
        </div>
        <div style="width: 50%; display: flex; justify-content: flex-end;">
            <a href="/zc_exporter" class="btn btn-primary" style="background-color: #0d6efd; border-color: #0d6efd; color: white; font-weight: bold; font-size: 1.1rem; padding: 10px 16px; margin-right: 8px;">‚ûï Add New</a>
        </div>
    </div>

    <div class="table-box">
        <div id="tableContainer" class="table-responsive">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Invoice Number</th>
                        <th>Invoice Date</th>
                        <th>Exporter Reference</th>
                        <th>Consignee Address</th>
                        <th>Total Invoice Value</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    <!-- Table rows will be populated by JavaScript -->
                </tbody>
            </table>
        </div>
        <div id="noDataMessage" style="display: none; text-align: center; padding: 40px; color: #999;">
            <p style="font-size: 1.2rem; margin: 0;">üì≠ No data available</p>
            <p style="font-size: 0.9rem; margin: 5px 0 0 0;">Click the "+ Add New" button to create your first record</p>
        </div>
    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        // Fetch data from server
        fetch('/api/zc-exporter')
            .then(response => response.json())
            .then(data => {
                if (Array.isArray(data) && data.length > 0) {
                    // Real data from database
                    const tableBody = document.getElementById('tableBody');
                    const tableContainer = document.getElementById('tableContainer');
                    const noDataMessage = document.getElementById('noDataMessage');
                    
                    tableBody.innerHTML = '';
                    tableContainer.style.display = 'block';
                    noDataMessage.style.display = 'none';
                    
                    // server returns data already ordered by updated/created/id (descending)
                    data.forEach((row, index) => {
                        if (row.visible !== false) {
                            const tr = document.createElement('tr');
                            tr.setAttribute('data-id', row.id);
                            tr.innerHTML = `
                                <td>${index + 1}</td>
                                <td>${row.invoiceNumber || '-'}</td>
                                <td>${row.invoiceDate || '-'}</td>
                                <td>${row.exporterReference || '-'}</td>
                                <td>${row.consigneeAddress || '-'}</td>
                                <td>${row.totalInvoiceValue || '0.00'}</td>
                                <td>
                                    <div class="action-buttons">
                                        <button class="btn btn-edit btn-sm" onclick="editRecord(${row.id})" title="Edit Record">‚úèÔ∏è Edit</button>
                                        <button class="btn btn-hide btn-sm" onclick="hideRecord(${row.id})" title="Hide Record">üëÅÔ∏è Hide</button>
                                        <button class="btn btn-print btn-sm" onclick="printRecord(${row.id})" title="Print Record">üñ®Ô∏è Print</button>
                                    </div>
                                </td>
                            `;
                            tableBody.appendChild(tr);
                        }
                    });
                } else {
                    showNoDataMessage();
                }
            })
            .catch(error => {
                console.log('Database not available', error);
                showNoDataMessage();
            });
    });

    function showNoDataMessage() {
        const tableContainer = document.getElementById('tableContainer');
        const noDataMessage = document.getElementById('noDataMessage');
        tableContainer.style.display = 'none';
        noDataMessage.style.display = 'block';
    }

    function editRecord(id) {
        // Redirect to edit page with record ID
        window.location.href = `/zc_exporter/edit?id=${id}`;
    }

    function hideRecord(id) {
        // Hide the row from the table using data-id attribute
        const rows = document.querySelectorAll('#tableBody tr');
        rows.forEach(row => {
            if (row.dataset && row.dataset.id == String(id)) {
                row.style.display = 'none';
            }
        });
    }

    function printRecord(id) {
        // Open the print page with full data
        window.open(`/zc_exporter/print/${id}`, '_blank');
    }
</script>

</body>
</html>